-- FINAL Journal Entry Query
SELECT  SUBSTR("V_GLACCT_YBB_ALL_PERIODS_CUMM"."ACCT",4,4)||SUBSTR("V_GLACCT_YBB_ALL_PERIODS_CUMM"."ACCT",9,4) AS ACCT,
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."ACCT" AS FULL_ACCT, 
        "V_GLYEAR_PERIODS"."FISCALYR", 
        "V_GLYEAR_PERIODS"."PERIOD", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."DESCRIP", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."MAJORTYPE", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."TYPE", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."YTD_BEGINNING", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."PERIOD_DEBIT", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."PERIOD_CREDIT", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."PERIOD_BALANCE", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."CUMM_PERIOD_BALANCE", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."EPLANT_ID", 
        "EPLANT"."COMPANY"
FROM   ("IQMS"."V_GLYEAR_PERIODS" "V_GLYEAR_PERIODS" 
        INNER JOIN "IQMS"."V_GLACCT_YBB_ALL_PERIODS_CUMM" "V_GLACCT_YBB_ALL_PERIODS_CUMM" ON ("V_GLYEAR_PERIODS"."GLYEAR_ID"="V_GLACCT_YBB_ALL_PERIODS_CUMM"."GLYEAR_ID") AND ("V_GLYEAR_PERIODS"."PERIOD_ID"="V_GLACCT_YBB_ALL_PERIODS_CUMM"."GLPERIODS_ID")) 
        LEFT OUTER JOIN "IQMS"."EPLANT" "EPLANT" ON "V_GLACCT_YBB_ALL_PERIODS_CUMM"."EPLANT_ID"="EPLANT"."ID"
WHERE  "V_GLYEAR_PERIODS"."FISCALYR" in ('2013','2014','2015','2016', '2017') 
  AND "V_GLACCT_YBB_ALL_PERIODS_CUMM"."EPLANT_ID"=1
ORDER BY "V_GLYEAR_PERIODS"."FISCALYR", "V_GLYEAR_PERIODS"."PERIOD", "V_GLACCT_YBB_ALL_PERIODS_CUMM"."ACCT", "V_GLACCT_YBB_ALL_PERIODS_CUMM"."MAJORTYPE";

-- FINAL COA Query
select distinct ACCT, FULL_ACCT, DESCRIP AS ACCT_DESCRIP, MAJORTYPE, TYPE AS TYPE_DESCRIP,'0' AS GLA_ID, '0'  AS GSA_ID, '0'  AS GSA_PARENT_ID
FROM
(SELECT  SUBSTR("V_GLACCT_YBB_ALL_PERIODS_CUMM"."ACCT",4,4)||SUBSTR("V_GLACCT_YBB_ALL_PERIODS_CUMM"."ACCT",9,4) AS ACCT,
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."ACCT" AS FULL_ACCT, 
        "V_GLYEAR_PERIODS"."FISCALYR", 
        "V_GLYEAR_PERIODS"."PERIOD", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."DESCRIP", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."MAJORTYPE", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."TYPE", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."YTD_BEGINNING", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."PERIOD_DEBIT", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."PERIOD_CREDIT", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."PERIOD_BALANCE", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."CUMM_PERIOD_BALANCE", 
        "V_GLACCT_YBB_ALL_PERIODS_CUMM"."EPLANT_ID", 
        "EPLANT"."COMPANY"
FROM   ("IQMS"."V_GLYEAR_PERIODS" "V_GLYEAR_PERIODS" 
        INNER JOIN "IQMS"."V_GLACCT_YBB_ALL_PERIODS_CUMM" "V_GLACCT_YBB_ALL_PERIODS_CUMM" ON ("V_GLYEAR_PERIODS"."GLYEAR_ID"="V_GLACCT_YBB_ALL_PERIODS_CUMM"."GLYEAR_ID") AND ("V_GLYEAR_PERIODS"."PERIOD_ID"="V_GLACCT_YBB_ALL_PERIODS_CUMM"."GLPERIODS_ID")) 
        LEFT OUTER JOIN "IQMS"."EPLANT" "EPLANT" ON "V_GLACCT_YBB_ALL_PERIODS_CUMM"."EPLANT_ID"="EPLANT"."ID"
WHERE  "V_GLYEAR_PERIODS"."FISCALYR" in ('2013','2014','2015','2016', '2017') 
  AND "V_GLACCT_YBB_ALL_PERIODS_CUMM"."EPLANT_ID"=1
)
ORDER BY ACCT;


-- All accounts with type and subtype
SELECT SUBSTR(GLA.ACCT,4,4)||SUBSTR(GLA.ACCT,9,4) AS ACCT, GLA.MAJORTYPE,  GSA.DESCRIP AS TYPE_DESCRIP, GLA.ACCT as FULL_ACCT, GLA.DESCRIP AS ACCT_DESCRIP, GLA.ID AS GLA_ID, GSA.ID AS GSA_ID, GSA.PARENT_ID AS GSA_PARENT_ID
--SELECT GLA.*, GSA.* 
FROM GLACCT GLA, GLSUB_ACCT_TYPE GSA
WHERE GLA.GL_SUBACCT_TYPE_ID = GSA.ID
AND GLA.EPLANT_ID = 1
--ORDER BY GLA.MAJORTYPE, GSA.DESCRIP, GLA.ACCT;
ORDER BY ACCT;


-- All accounts with type and subtype
--SELECT DISTINCT SUBSTR(GLA.ACCT,4,4)||SUBSTR(GLA.ACCT,9,4) 
SELECT SUBSTR(GLA.ACCT,4,1)||SUBSTR(GLA.ACCT,6,2)||SUBSTR(GLA.ACCT,9,4) , count(SUBSTR(GLA.ACCT,4,1)||SUBSTR(GLA.ACCT,6,2)||SUBSTR(GLA.ACCT,9,4)) as 
--SELECT GLA.*, GSA.* 
FROM GLACCT GLA, GLSUB_ACCT_TYPE GSA
WHERE GLA.GL_SUBACCT_TYPE_ID = GSA.ID
AND GLA.EPLANT_ID = 1
--ORDER BY GLA.MAJORTYPE, GSA.DESCRIP, GLA.ACCT;
--ORDER BY SUBSTR(GLA.ACCT,4,4)||SUBSTR(GLA.ACCT,9,4);
GROUP BY SUBSTR(GLA.ACCT,4,1)||SUBSTR(GLA.ACCT,6,2)||SUBSTR(GLA.ACCT,9,4)
ORDER BY SUBSTR(GLA.ACCT,4,1)||SUBSTR(GLA.ACCT,6,2)||SUBSTR(GLA.ACCT,9,4);



-- Final AP Invoice Detail Query
 SELECT SUBSTR(GLACCT.ACCT,4,4)||SUBSTR(GLACCT.ACCT,9,4) AS ACCT,
  "GLACCT"."ACCT" AS FULL_ACCT,
  "V_APINVOICE_CHEQUE"."INVOICE_NO", 
  "APINVOICE_DETAIL"."APINVOICE_ID", 
  "V_APINVOICE_CHEQUE"."INVOICE_AMOUNT", 
  "V_APINVOICE_CHEQUE"."AMOUNT_TO_PAY", 
  "VENDOR"."VENDORNO", "VENDOR"."COMPANY", 
  "V_APINVOICE_CHEQUE"."DAYS_OVERDUE", 
  TO_CHAR("V_APINVOICE_CHEQUE"."INVOICE_DATE", 'YYYY-MM-DD') AS INVOICE_DATE,
  TO_CHAR("V_APINVOICE_CHEQUE"."DISC_DATE", 'YYYY-MM-DD') AS DISC_DATE, 
  TO_CHAR("V_APINVOICE_CHEQUE"."DUE_DATE", 'YYYY-MM-DD') AS DUE_DATE,
  "V_APINVOICE_CHEQUE"."CURR_CODE", 
  "VENDOR"."ID", "V_APINVOICE_CHEQUE"."ON_HOLD", 
  "GLACCT"."DESCRIP",
  "APINVOICE_DETAIL".ARINVT_ITEMNO,
  "PO_DETAIL".MISC_ITEM,
  "APINVOICE_DETAIL".QTY_INVOICED,
  "APINVOICE_DETAIL".UNIT_COST,
  "APINVOICE_DETAIL"."AMOUNT_BEFORE_TAX"
 FROM   ((((((("IQMS"."VENDOR" "VENDOR" 
          LEFT OUTER JOIN "IQMS"."V_APINVOICE_CHEQUE" "V_APINVOICE_CHEQUE" ON "VENDOR"."ID"="V_APINVOICE_CHEQUE"."VENDOR_ID") 
          LEFT OUTER JOIN "IQMS"."EPLANT" "EPLANT" ON "V_APINVOICE_CHEQUE"."EPLANT_ID"="EPLANT"."ID") 
          LEFT OUTER JOIN "IQMS"."CURRENCY" "CURRENCY" ON "V_APINVOICE_CHEQUE"."CURRENCY_ID"="CURRENCY"."ID") 
          LEFT OUTER JOIN "IQMS"."APINVOICE" "APINVOICE" ON "V_APINVOICE_CHEQUE"."ID"="APINVOICE"."ID") 
          LEFT OUTER JOIN "IQMS"."APINVOICE_DETAIL" "APINVOICE_DETAIL" ON "APINVOICE"."ID"="APINVOICE_DETAIL"."APINVOICE_ID") 
          LEFT OUTER JOIN "IQMS"."GLACCT" "GLACCT" ON "APINVOICE_DETAIL"."GLACCT_ID_EXPENSE"="GLACCT"."ID") 
          LEFT OUTER JOIN "IQMS"."PO_DETAIL" "PO_DETAIL" ON "APINVOICE_DETAIL"."PO_DETAIL_ID"="PO_DETAIL"."ID") 
          LEFT OUTER JOIN "IQMS"."IQSYS" "IQSYS" ON "CURRENCY"."ID"="IQSYS"."CURRENCY_ID"
 WHERE  "V_APINVOICE_CHEQUE"."AMOUNT_TO_PAY"<>0
 AND "EPLANT"."ID" = 1
 ORDER BY "VENDOR"."COMPANY", "VENDOR"."ID", "V_APINVOICE_CHEQUE"."INVOICE_NO";


 SELECT "APINVOICE"."VENDOR_COMPANY", "APINVOICE"."VENDOR_ID", "APINVOICE"."INVOICE_NO", "APINVOICE_DETAIL"."ARINVT_ITEMNO", "APINVOICE_DETAIL"."MISC_COMMENT", "APINVOICE_DETAIL"."ARINVT_DESCRIP", "APINVOICE_DETAIL"."UNIT_COST", "V_PO_COMB"."UNIT_PRICE", "APINVOICE_DETAIL"."QTY_INVOICED", "APINVOICE"."EPLANT_ID", "EPLANT"."COMPANY", "APINVOICE"."INVOICE_DATE"
 FROM   (("IQMS"."APINVOICE" "APINVOICE" LEFT OUTER JOIN "IQMS"."APINVOICE_DETAIL" "APINVOICE_DETAIL" ON "APINVOICE"."ID"="APINVOICE_DETAIL"."APINVOICE_ID") LEFT OUTER JOIN "IQMS"."EPLANT" "EPLANT" ON "APINVOICE"."EPLANT_ID"="EPLANT"."ID") LEFT OUTER JOIN "IQMS"."V_PO_COMB" "V_PO_COMB" ON "APINVOICE_DETAIL"."PO_DETAIL_ID"="V_PO_COMB"."PO_DETAIL_ID"
 WHERE  "V_PO_COMB"."UNIT_PRICE" IS  NOT  NULL 
 ORDER BY "APINVOICE"."VENDOR_COMPANY", "APINVOICE"."VENDOR_ID", "APINVOICE"."INVOICE_NO";




-- AP Invoice Query
 SELECT "V_APINVOICE_CHEQUE"."INVOICE_NO", 
  "V_APINVOICE_CHEQUE"."INVOICE_AMOUNT", 
  "V_APINVOICE_CHEQUE"."AMOUNT_TO_PAY", 
  "VENDOR"."VENDORNO", 
  REPLACE(REPLACE("VENDOR"."COMPANY", '/', ' '), '_', ' ') as "Company", 
  "V_APINVOICE_CHEQUE"."DAYS_OVERDUE", 
  "V_APINVOICE_CHEQUE"."INVOICE_DATE", 
  "V_APINVOICE_CHEQUE"."DISC_DATE", 
  "V_APINVOICE_CHEQUE"."DUE_DATE", 
  "V_APINVOICE_CHEQUE"."CURR_CODE", 
  "V_APINVOICE_CHEQUE"."CURRENCY_DESCRIP", 
  "CURRENCY"."SPOT_RATE", 
  "V_APINVOICE_CHEQUE"."EPLANT_ID", 
  "VENDOR"."ID", "V_APINVOICE_CHEQUE"."ON_HOLD", 
  "EPLANT"."COMPANY", 
  "APINVOICE"."FX_REVALUE_RATE", 
  "APINVOICE"."FX_RATE", 
  "EPLANT"."NATIVE_CURR", 
  "IQSYS"."CURRENCYCODE", 
  "EPLANT"."ID", "IQSYS"."MULTICURRENCY"
 FROM   (((("IQMS"."VENDOR" "VENDOR" LEFT OUTER JOIN "IQMS"."V_APINVOICE_CHEQUE" "V_APINVOICE_CHEQUE" ON "VENDOR"."ID"="V_APINVOICE_CHEQUE"."VENDOR_ID") LEFT OUTER JOIN "IQMS"."EPLANT" "EPLANT" ON "V_APINVOICE_CHEQUE"."EPLANT_ID"="EPLANT"."ID") LEFT OUTER JOIN "IQMS"."CURRENCY" "CURRENCY" ON "V_APINVOICE_CHEQUE"."CURRENCY_ID"="CURRENCY"."ID") LEFT OUTER JOIN "IQMS"."APINVOICE" "APINVOICE" ON "V_APINVOICE_CHEQUE"."ID"="APINVOICE"."ID") LEFT OUTER JOIN "IQMS"."IQSYS" "IQSYS" ON "CURRENCY"."ID"="IQSYS"."CURRENCY_ID"
 WHERE  "V_APINVOICE_CHEQUE"."AMOUNT_TO_PAY"<>0
 ORDER BY "V_APINVOICE_CHEQUE"."CURR_CODE", "VENDOR"."COMPANY", "VENDOR"."ID", "V_APINVOICE_CHEQUE"."INVOICE_NO";





-- Account Type Tree
SELECT * FROM GLSUB_ACCT_TYPE ORDER BY ID, PARENT_ID;


(
    SELECT DESCRIP, ID, PARENT_ID, LEVEL, 1 AS GRP
    FROM GLSUB_ACCT_TYPE
    START WITH id = 1
    CONNECT BY PRIOR id = parent_id
) UNION (
    SELECT DESCRIP, ID, PARENT_ID, LEVEL, 2 AS GRP
    FROM GLSUB_ACCT_TYPE
    START WITH id = 2
    CONNECT BY PRIOR id = parent_id
) UNION (
    SELECT DESCRIP, ID, PARENT_ID, LEVEL, 3 AS GRP
    FROM GLSUB_ACCT_TYPE
    START WITH id = 3
    CONNECT BY PRIOR id = parent_id
) UNION (
    SELECT DESCRIP, ID, PARENT_ID, LEVEL, 4 AS GRP
    FROM GLSUB_ACCT_TYPE
    START WITH id = 4
    CONNECT BY PRIOR id = parent_id
) UNION (
    SELECT DESCRIP, ID, PARENT_ID, LEVEL, 5 AS GRP
    FROM GLSUB_ACCT_TYPE
    START WITH id = 5
    CONNECT BY PRIOR id = parent_id
)
ORDER BY GRP, ID;

select * from vendor where WEB_SITE_URL like 'www:%';

-- Vendors
select COALESCE(NULLIF(PRIME_CONTACT,''), REPLACE(COMPANY, '/', ' ')) as "Name", 
        --PRIME_CONTACT as "Name", 
        REPLACE(REPLACE(COMPANY, '/', ' '), '_', ' ') as "Company", 
        E_MAIL_ADDR as "Email", 
        PHONE_NUMBER as "Phone",     
        '' as "Mobile",
        FAX_NUMBER as "Fax",
        WEB_SITE_URL as "Website" ,
        ADDR1||' '||ADDR2 as "Street", 
        CITY as "City", 
        STATE as "State", 
        ZIP as "Zip",
        COUNTRY as "Country",
        '0' AS "Opening Balance",
        TO_CHAR(NVL(CREATED, SYSDATE), 'yyyy-mm-dd') as "Opening Balance Date",
        FED_TAX_ID as "Tax ID"
from vendor
where eplant_id = 1
and COMPANY <> 'TBD';


-- Customers
select COALESCE(NULLIF(PRIME_CONTACT,''), REPLACE(COMPANY, '/', ' ')) as "Name", 
        --PRIME_CONTACT as "Name", 
        REPLACE(REPLACE(COMPANY, '/', ' '), '_', ' ') as "Company",
        PRIME_CONTACT_EMAIL as "Email", 
        PHONE_NUMBER as "Phone",     
        '' as "Mobile",
        FAX_NUMBER as "Fax",
        WEB_SITE_URL as "Website" ,
        ADDR1||' '||ADDR2 as "Street", 
        CITY as "City", 
        STATE as "State", 
        ZIP as "Zip",
        COUNTRY as "Country",
        '0' AS "Opening Balance",
        TO_CHAR(NVL(CREATED, SYSDATE), 'yyyy-mm-dd') as "Opening Balance Date"
        --FED_TAX_ID as "Tax ID"
from arcusto
where eplant_id = 1 AND STATUS_ID='Active';



